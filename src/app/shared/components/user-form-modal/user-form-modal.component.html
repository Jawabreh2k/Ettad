<app-modal
  [isOpen]="isOpen"
  [title]="title"
  size="md"
  (closed)="close()"
>
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <!-- Error Message -->
    <div *ngIf="errorMessage" class="mb-4 p-3 bg-[var(--color-error)]/10 border border-[var(--color-error)] rounded-lg">
      <p class="text-sm text-[var(--color-error)]">{{ errorMessage }}</p>
    </div>

    <div class="space-y-4">
      <!-- Personal Information -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            First Name <span class="text-[var(--color-error)]">*</span>
          </label>
          <input
            type="text"
            formControlName="firstName"
            placeholder="John"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
            [class.border-[var(--color-error)]]="userForm.get('firstName')?.invalid && userForm.get('firstName')?.touched"
          />
          <p *ngIf="getFieldError('firstName')" class="mt-1 text-sm text-[var(--color-error)]">
            {{ getFieldError('firstName') }}
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            Last Name <span class="text-[var(--color-error)]">*</span>
          </label>
          <input
            type="text"
            formControlName="lastName"
            placeholder="Doe"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
            [class.border-[var(--color-error)]]="userForm.get('lastName')?.invalid && userForm.get('lastName')?.touched"
          />
          <p *ngIf="getFieldError('lastName')" class="mt-1 text-sm text-[var(--color-error)]">
            {{ getFieldError('lastName') }}
          </p>
        </div>
      </div>

      <!-- Contact Information -->
      <div>
        <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
          Email <span class="text-[var(--color-error)]">*</span>
        </label>
        <input
          type="email"
          formControlName="email"
          placeholder="john.doe@barzan.com"
          class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
          [class.border-[var(--color-error)]]="userForm.get('email')?.invalid && userForm.get('email')?.touched"
        />
        <p *ngIf="getFieldError('email')" class="mt-1 text-sm text-[var(--color-error)]">
          {{ getFieldError('email') }}
        </p>
      </div>

      <div>
        <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
          Phone
        </label>
        <input
          type="tel"
          formControlName="phone"
          placeholder="+974 1234 5678"
          class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
        />
      </div>

      <!-- Role and Department -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            Role <span class="text-[var(--color-error)]">*</span>
          </label>
          <select
            formControlName="roleId"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
            [class.border-[var(--color-error)]]="userForm.get('roleId')?.invalid && userForm.get('roleId')?.touched"
          >
            <option value="">Select a role</option>
            <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
          </select>
          <p *ngIf="getFieldError('roleId')" class="mt-1 text-sm text-[var(--color-error)]">
            {{ getFieldError('roleId') }}
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            Department
          </label>
          <input
            type="text"
            formControlName="department"
            placeholder="e.g., IT, Operations"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
          />
        </div>
      </div>

      <!-- Status -->
      <div>
        <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
          Status <span class="text-[var(--color-error)]">*</span>
        </label>
        <select
          formControlName="status"
          class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
        >
          <option *ngFor="let status of userStatuses" [value]="status.value">{{ status.label }}</option>
        </select>
      </div>

      <!-- Password (Only for Create Mode) -->
      <div *ngIf="mode === 'create'" class="space-y-4 pt-4 border-t border-[var(--color-border)]">
        <h4 class="font-medium text-[var(--color-text)]">Set Password</h4>
        
        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            Password <span class="text-[var(--color-error)]">*</span>
          </label>
          <input
            type="password"
            formControlName="password"
            placeholder="••••••••"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
            [class.border-[var(--color-error)]]="userForm.get('password')?.invalid && userForm.get('password')?.touched"
          />
          <p *ngIf="getFieldError('password')" class="mt-1 text-sm text-[var(--color-error)]">
            {{ getFieldError('password') }}
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-[var(--color-text)] mb-2">
            Confirm Password <span class="text-[var(--color-error)]">*</span>
          </label>
          <input
            type="password"
            formControlName="confirmPassword"
            placeholder="••••••••"
            class="w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent outline-none"
            [class.border-[var(--color-error)]]="!passwordsMatch && userForm.get('confirmPassword')?.touched"
          />
          <p *ngIf="!passwordsMatch && userForm.get('confirmPassword')?.touched" class="mt-1 text-sm text-[var(--color-error)]">
            Passwords do not match
          </p>
        </div>
      </div>
    </div>
  </form>

  <!-- Footer -->
  <div modal-footer class="flex gap-3">
    <app-button
      variant="outline"
      (clicked)="close()"
      [disabled]="isLoading"
    >
      Cancel
    </app-button>
    <app-button
      variant="primary"
      (clicked)="onSubmit()"
      [disabled]="isLoading || userForm.invalid || (mode === 'create' && !passwordsMatch)"
    >
      {{ isLoading ? 'Saving...' : (mode === 'create' ? 'Create User' : 'Update User') }}
    </app-button>
  </div>
</app-modal>

